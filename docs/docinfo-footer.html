<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/3.0.2/tocbot.min.js"></script>
<script>
  var oldtoc = document.getElementById('toctitle').nextElementSibling;
  var newtoc = document.createElement('div');
  newtoc.setAttribute('id', 'tocbot');
  newtoc.setAttribute('class', 'js-toc');
  oldtoc.parentNode.replaceChild(newtoc, oldtoc);
  tocbot.init({
    contentSelector: '#content',
    headingSelector: 'h1, h2, h3, h4, h5',
    ignoreSelector: '.discrete',
    smoothScroll: false
  });
  var handleTocOnResize = function () {
    var width = window.innerWidth
        || document.documentElement.clientWidth
        || document.body.clientWidth;
    if (width < 768) {
      tocbot.refresh({
        contentSelector: '#content',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 6,
        ignoreSelector: '.discrete',
        throttleTimeout: 1000,
        smoothScroll: false
      });
    } else {
      tocbot.refresh();
    }
  };
  window.addEventListener('resize', handleTocOnResize);
  handleTocOnResize();
  $(function () {
    window.location.hash = window.location.hash;
  });
</script>
<script>
  var primarySelector = '.primary';
  var secondarySelector = '.secondary';
  function addBlockSwitches() {
    $(primarySelector).each(function() {
      primary = $(this);
      createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
      primary.children('.title').remove();
    });
    $(secondarySelector).each(function(idx, node) {
      secondary = $(node);
      primary = findPrimary(secondary);
      var title = secondary.children('.title').text();
      if (title === 'Kotlin') {
        var item = primary.children('.switch').children('.switch--item');
        if (item.text() !== 'Java') {
          primary.prepend('<div class="title">' + item.text() + '</div>');
          item.text('Java');
        }
      }
      switchItem = createSwitchItem(secondary, primary.children('.switch'));
      switchItem.content.addClass('hidden');
      findPrimary(secondary).append(switchItem.content);
      secondary.remove();
    });
  }

  function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
  }

  function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is(primarySelector)) {
      candidate = candidate.prev();
    }
    return candidate;
  }

  function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first();
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
      $(this).addClass('selected');
      $(this).siblings().removeClass('selected');
      e.data.siblings('.content').addClass('hidden');
      e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
  }

  $(addBlockSwitches);
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>

<script>
  $(function() {
    $('code').each(function () {
        $(this).removeAttr('data-lang');
    });
    var pre = document.getElementsByTagName('pre');
    for (var i = 0; i < pre.length; i++) {
      var b = document.createElement('button');
      b.className = 'clipboard';
      b.textContent = 'Copy';
      if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
        var div = document.createElement('div');
        div.textContent = pre[i].textContent;
        pre[i].textContent = '';
        pre[i].appendChild(div);
      }
      pre[i].appendChild(b);
    }
    new ClipboardJS('.clipboard', {
      target: function(b) {
        var p = b.parentNode;
        var target = p.childNodes[0];
        return target;
      }
    }).on('success', function(e) {
      e.clearSelection();
      e.trigger.textContent = 'Copied';
      setTimeout(function() {
        e.trigger.textContent = 'Copy';
      }, 2000);
    });
  });
</script>
